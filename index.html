<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Tabl√≥n del Clan - Pax Dei</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@500&display=swap');
    @import url('https://fonts.googleapis.com/css2?family=MedievalSharp&display=swap');

    body {
      font-family: 'Cinzel', serif;
      background: #3a2f23 url('https://www.transparenttextures.com/patterns/wood-pattern.png');
      margin: 0;
      color: #fdf5e6;
      font-size: 17px;
    }

    header {
      background: linear-gradient(#4b3a28, #2c1f12);
      text-align: center;
      padding: 25px;
      border-bottom: 5px solid #2c1f12;
      box-shadow: inset 0 0 30px rgba(0, 0, 0, 0.6);
    }

    header h1 {
      font-size: 2.3em;
      color: #e0c28b;
      text-shadow: 3px 3px #000;
    }

    main {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }

    nav {
      margin-bottom: 20px;
    }

    nav button {
      background: #6b4b2e;
      color: #fdf5e6;
      border: 2px solid #2c1f12;
      padding: 10px 20px;
      margin: 0 5px;
      cursor: pointer;
      border-radius: 8px;
      font-weight: bold;
      transition: 0.3s;
      box-shadow: 0 3px 5px rgba(0,0,0,0.5);
      font-size: 16px;
    }

    nav button:hover { background: #8b643a; transform: scale(1.05); }
    nav button.active { background: #c49a5f; color: #2c1f12; border: 2px solid #f0e2b6; }

    section {
      display: none;
      width: 100%;
      max-width: 900px;
      background: #f8ecd2 url('https://www.transparenttextures.com/patterns/aged-paper.png');
      color: #2c1f12;
      padding: 25px;
      border-radius: 15px;
      border: 4px solid #2c1f12;
      box-shadow: inset 0 0 20px rgba(0,0,0,0.5);
      animation: fadeIn 0.5s ease-in-out;
    }

    section.active { display: block; }

    @keyframes fadeIn { from { opacity:0; transform:scale(0.98);} to { opacity:1; transform:scale(1);} }

    label { font-weight: bold; color: #2c1f12; }

    input, select {
      width: 100%;
      padding: 8px;
      margin-bottom: 10px;
      font-family: 'Cinzel', serif;
      background: #f5e3b3;
      border: 2px solid #2c1f12;
      border-radius: 5px;
      color: #2c1f12;
      font-size: 17px;
    }

    button.submit {
      background: #c49a5f;
      color: #2c1f12;
      border: 2px solid #f0e2b6;
      padding: 10px 15px;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
      transition: 0.3s;
      font-size: 16px;
    }

    button.submit:hover { background: #d8b36e; transform: scale(1.05); }

    .mision {
      background: #f5e3b3;
      border: 3px solid #2c1f12;
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 15px;
      color: #2c1f12;
      box-shadow: 0 0 10px rgba(0,0,0,0.4);
      transition: 0.3s;
      font-size: 17px;
    }

    .mision:hover { transform: translateY(-3px); box-shadow: 0 0 15px rgba(0,0,0,0.6); }
    .mision.tomada { background: #d6c08a; }

    .mision h3 { margin-top: 0; color: #3b2a1a; font-size: 1.4em; }
    .recompensa { color: #a67c00; font-weight: bold; }

    .botones-mision button {
      background: #6b4b2e;
      color: #fdf5e6;
      border: 2px solid #2c1f12;
      padding: 6px 10px;
      border-radius: 5px;
      cursor: pointer;
      margin-right: 6px;
      transition: 0.2s;
      font-size: 15px;
    }
    .botones-mision button:hover { background: #8b643a; }

    h2 { font-size: 1.7em; text-align: center; color: #2c1f12; border-bottom: 2px solid #c49a5f; padding-bottom:5px; letter-spacing:1px; }

    .filtros { display:flex; justify-content:center; gap:15px; margin-bottom:15px; align-items:center; }
    .filtros select, .filtros button { font-size: 16px; padding: 7px 12px; }
  </style>
</head>
<body>
  <header><h1>Tabl√≥n del Clan - Pax Dei</h1></header>

  <main>
    <nav>
      <button id="btn-crear" class="active">‚ûï Crear Misi√≥n</button>
      <button id="btn-ver">üìú Ver Misiones</button>
      <button id="btn-completadas">‚úÖ Completadas</button>
    </nav>

    <!-- CREAR -->
    <section id="crear" class="active">
      <form id="formMision">
        <input type="text" id="titulo" placeholder="T√≠tulo autom√°tico" readonly>
        <label>Recurso necesario:</label>
        <div style="display:flex; gap:10px;">
          <select id="stacks" style="flex:1;"><option value="">Stacks</option></select>
          <select id="recurso" style="flex:2;"><option value="">Selecciona un recurso</option></select>
        </div>
        <input type="number" id="oro" placeholder="Recompensa en oro" required>
        <input type="text" id="autor" placeholder="Tu nombre" required>
        <button type="submit" class="submit">üìú Agregar misi√≥n</button>
      </form>
    </section>

    <!-- VER -->
    <section id="ver">
      <h2>Misiones Activas</h2>
      <div class="filtros">
        <select id="filtroRecurso"><option value="">Todos los recursos</option></select>
        <button id="ordenarOro">üí∞ Ordenar por recompensa</button>
      </div>
      <div id="listaMisiones"></div>
    </section>

    <!-- COMPLETADAS -->
    <section id="completadas">
      <h2>Misiones Completadas</h2>
      <div class="filtros">
        <select id="filtroCreador"><option value="">Todos los autores</option></select>
        <select id="filtroCompletado"><option value="">Todos los que completaron</option></select>
      </div>
      <div id="listaCompletadas"></div>
    </section>
  </main>

  <script>
    const recursos = { Albura:50, Arcilla:100, Arena:100, Arenisca:100, Caliza:100, Intestino_de_animales:50, Juncos:75, Gneis:100, Granito:100, Grasa_animal:50, Pedernal:100, Resina:50, Duramen:50, Pezu√±a_de_animal:20, Cornamenta:10, Fibra_de_Algod√≥n:50, Sebo:50, Carb√≥n_vegetal:100, Ladrillo:20, Tejas_de_arcilla:50, Viga_de_madera_refinada:20, Tabl√≥n_de_madera_refinada:50, Viga_de_madera:20, Tabl√≥n_de_madera:50, Paja:100, Palo_largo:10, Palo_largo_refinado:10 };

    const form = document.getElementById('formMision');
    const titulo = document.getElementById('titulo');
    const stacksSel = document.getElementById('stacks');
    const recursoSel = document.getElementById('recurso');
    const oroInput = document.getElementById('oro');
    const autorInput = document.getElementById('autor');
    const filtroRecurso = document.getElementById('filtroRecurso');
    const ordenarBtn = document.getElementById('ordenarOro');
    const listaMisiones = document.getElementById('listaMisiones');
    const listaCompletadas = document.getElementById('listaCompletadas');
    const filtroCreador = document.getElementById('filtroCreador');
    const filtroCompletado = document.getElementById('filtroCompletado');

    const secciones = { crear: document.getElementById('crear'), ver: document.getElementById('ver'), completadas: document.getElementById('completadas') };
    const botones = { crear: document.getElementById('btn-crear'), ver: document.getElementById('btn-ver'), completadas: document.getElementById('btn-completadas') };
    Object.keys(botones).forEach(k => {
      botones[k].addEventListener('click', () => {
        Object.values(secciones).forEach(s => s.classList.remove('active'));
        Object.values(botones).forEach(b => b.classList.remove('active'));
        secciones[k].classList.add('active'); botones[k].classList.add('active');
        if (k === 'ver') renderMisiones();
        if (k === 'completadas') renderCompletadas();
      });
    });

    for (let i=1;i<=36;i++){
      const o = document.createElement('option'); o.value = i; o.textContent = i; stacksSel.appendChild(o);
    }

    Object.keys(recursos).forEach(r => {
      const o = document.createElement('option'); o.value = r; o.textContent = r; recursoSel.appendChild(o);
      filtroRecurso.appendChild(o.cloneNode(true));
    });

    function actualizarTitulo() {
      if (stacksSel.value && recursoSel.value) titulo.value = `Recolectar ${stacksSel.value} stacks de ${recursoSel.value}`;
      else titulo.value = '';
    }
    stacksSel.addEventListener('change', actualizarTitulo);
    recursoSel.addEventListener('change', actualizarTitulo);

    let misiones = JSON.parse(localStorage.getItem('misiones')) || [];
    let completadas = JSON.parse(localStorage.getItem('completadas')) || [];
    let ordenarPorOro = false;

    function guardar() {
      localStorage.setItem('misiones', JSON.stringify(misiones));
      localStorage.setItem('completadas', JSON.stringify(completadas));
    }

    form.addEventListener('submit', e => {
      e.preventDefault();
      if (!titulo.value) { alert('Selecciona un stack y un recurso.'); return; }
      const id = Date.now() + Math.floor(Math.random()*1000);
      const nueva = {
        id,
        titulo: titulo.value,
        stack: parseInt(stacksSel.value),
        recurso: recursoSel.value,
        oro: parseInt(oroInput.value) || 0,
        autor: autorInput.value || 'An√≥nimo',
        fecha: new Date().toLocaleDateString(),
        tomadoPor: null
      };
      misiones.unshift(nueva); guardar(); form.reset(); titulo.value = ''; renderMisiones();
    });

    function renderMisiones() {
      listaMisiones.innerHTML = '';
      let visible = [...misiones];

      if (filtroRecurso.value) visible = visible.filter(m => m.recurso === filtroRecurso.value);
      if (ordenarPorOro) visible.sort((a,b) => b.oro - a.oro);

      if (visible.length === 0) { listaMisiones.innerHTML = '<p>No hay misiones activas con esos criterios.</p>'; return; }

      visible.forEach(m => {
        const total = (recursos[m.recurso] || 0) * m.stack;
        const card = document.createElement('div');
        card.className = 'mision' + (m.tomadoPor ? ' tomada' : '');
        card.innerHTML = `<h3>${m.titulo}</h3>
          <p>üè∑Ô∏è Recurso: ${m.recurso} (${m.stack} stacks = ${total} unidades)</p>
          <p>üìÖ Creada el: ${m.fecha}</p>
          <p>üë§ Autor: ${m.autor}</p>
          <p class="recompensa">üí∞ Recompensa: ${m.oro} oro</p>`;

        const btns = document.createElement('div'); btns.className = 'botones-mision';

        if (!m.tomadoPor) {
          const takeBtn = document.createElement('button'); takeBtn.textContent = 'ü™ì Tomar';
          takeBtn.addEventListener('click', () => { tomarMisionPorId(m.id); });
          btns.appendChild(takeBtn);
        } else {
          const completeBtn = document.createElement('button'); completeBtn.textContent = '‚úÖ Completar';
          completeBtn.addEventListener('click', () => { completarMisionPorId(m.id); });
          btns.appendChild(completeBtn);
        }

        const delBtn = document.createElement('button'); delBtn.textContent = 'üóëÔ∏è Borrar';
        delBtn.addEventListener('click', () => { borrarMisionPorId(m.id); });
        btns.appendChild(delBtn);

        card.appendChild(btns);
        listaMisiones.appendChild(card);
      });
    }

    function tomarMisionPorId(id) {
      const m = misiones.find(x => x.id === id);
      if (!m) return alert('No se encontr√≥ la misi√≥n (recarga la p√°gina si persiste).');
      const nombre = prompt('Ingresa tu nombre para tomar la misi√≥n:');
      if (!nombre) return;
      m.tomadoPor = nombre;
      guardar();
      renderMisiones();
    }

    function completarMisionPorId(id) {
      const idx = misiones.findIndex(x => x.id === id);
      if (idx === -1) return alert('No se encontr√≥ la misi√≥n.');
      const m = misiones[idx];
      m.completadaPor = m.tomadoPor || 'Desconocido';
      completadas.unshift(m);
      misiones.splice(idx,1);
      guardar();
      renderMisiones();
      renderCompletadas();
    }

    function borrarMisionPorId(id) {
      if (!confirm('¬øBorrar esta misi√≥n?')) return;
      misiones = misiones.filter(x => x.id !== id);
      guardar();
      renderMisiones();
    }

    function renderCompletadas() {
      listaCompletadas.innerHTML = '';
      if (completadas.length === 0) { listaCompletadas.innerHTML = '<p>No hay misiones completadas.</p>'; return; }

      // obtener nombres √∫nicos
      const autores = [...new Set(completadas.map(m => m.autor))];
      const completadores = [...new Set(completadas.map(m => m.completadaPor))];

      // llenar select sin duplicados y sin perder selecci√≥n
      const prevCreador = filtroCreador.value;
      filtroCreador.innerHTML = '<option value="">Todos los autores</option>';
      autores.forEach(a => { const o = document.createElement('option'); o.value = a; o.textContent = a; filtroCreador.appendChild(o); });
      filtroCreador.value = prevCreador;

      const prevCompletado = filtroCompletado.value;
      filtroCompletado.innerHTML = '<option value="">Todos los que completaron</option>';
      completadores.forEach(c => { const o = document.createElement('option'); o.value = c; o.textContent = c; filtroCompletado.appendChild(o); });
      filtroCompletado.value = prevCompletado;

      let visible = [...completadas];
      if (filtroCreador.value) visible = visible.filter(m => m.autor === filtroCreador.value);
      if (filtroCompletado.value) visible = visible.filter(m => m.completadaPor === filtroCompletado.value);

      if (visible.length === 0) { listaCompletadas.innerHTML = '<p>No hay misiones que cumplan los criterios.</p>'; return; }

      visible.forEach(m => {
        const card = document.createElement('div'); 
        card.className = 'mision tomada';
        card.innerHTML = `<h3>${m.titulo}</h3>
          <p>üè∑Ô∏è Recurso: ${m.recurso} (${m.stack} stacks)</p>
          <p>üí∞ Recompensa: ${m.oro} oro</p>
          <p>üë§ Creada por: <strong>${m.autor}</strong></p>
          <p>‚úÖ Completada por: <strong>${m.completadaPor || '‚Äî'}</strong></p>`;
        listaCompletadas.appendChild(card);
      });
    }

    filtroRecurso.addEventListener('change', renderMisiones);
    ordenarBtn.addEventListener('click', () => {
      ordenarPorOro = !ordenarPorOro;
      ordenarBtn.textContent = ordenarPorOro ? 'üîΩ Mostrar todas' : 'üí∞ Ordenar por recompensa';
      renderMisiones();
    });

    filtroCreador.addEventListener('change', renderCompletadas);
    filtroCompletado.addEventListener('change', renderCompletadas);

    renderMisiones();
    renderCompletadas();
  </script>
</body>
</html>
